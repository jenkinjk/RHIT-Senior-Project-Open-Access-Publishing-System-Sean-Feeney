{% extends "base.html" %}
{% block head %}
<!-- grab Jquery from a CDN, so we don't have to save and serve it -->
<script src="http://code.jquery.com/jquery-2.1.4.js"></script>
<script src="{{url_for('static', filename='dist/build/pdf.js')}}"></script>

<script>
  //   // Specify the main script used to create a new PDF.JS web worker.
  //   // In production, leave this undefined or change it to point to the
  //   // combined `pdf.worker.js` file.
  //   PDFJS.workerSrc = '../../src/worker_loader.js';
  // </script>
<script>
'use strict';

//
// Fetch the PDF document from the URL using promises
//
PDFJS.getDocument('/uploads/{{uniqueID}}').then(function(pdf) {
  // Using promise to fetch the page
  pdf.getPage(1).then(function(page) {
    var scale = 0.25;
    var viewport = page.getViewport(scale);

    //
    // Prepare canvas using PDF page dimensions
    //
    var canvas = document.getElementById('the-canvas');
    var context = canvas.getContext('2d');
    canvas.height = viewport.height;
    canvas.width = viewport.width;

    //
    // Render PDF page into canvas context
    //
    var renderContext = {
      canvasContext: context,
      viewport: viewport
    };
    page.render(renderContext);
  });
});
</script>
</head>


{% endblock %}
{% block title %}PDF Viewer{% endblock %}
{% block pageTitle %}PDF Viewer{% endblock %}
{% block content %}
<!-- <iframe src="/uploads/{{uniqueID}}" width="800" height="800"></iframe> -->

<div class="container">
	<div class="row">
		<div class="col-md-10 col-md-offset-1">
			{% if favorited %}
			<button id="fav" style="display: none" onclick="addFavorite();">Favorite!</button>
			<button id="unfav" onclick="rmFavorite();">Unfavorite!</button>
			{% else %}
			<button id="fav" onclick="addFavorite();">Favorite!</button>
			<button id="unfav" style="display: none" onclick="rmFavorite();">Unfavorite!</button>
			{% endif %}
			<br>
			{% for tagName in paper.tags %}
				{{ tagName }}
				{% if favoritedTags[loop.index - 1] %}
	                <button id="favTag{{tagName}}" style="display: none" onclick="addFavoriteTag('{{tagName}}');">Favorite Tag!</button>
	                <button id="defavTag{{tagName}}" onclick="rmFavoriteTag('{{tagName}}');">Unfavorite Tag!</button>
                {% else %}
	                <button id="favTag{{tagName}}" onclick="addFavoriteTag('{{tagName}}');">Favorite Tag!</button>
	                <button id="defavTag{{tagName}}" style="display: none" onclick="rmFavoriteTag('{{tagName}}');">Unfavorite Tag!</button>
                {% endif %}
                <br>
            {% endfor %}
            <br>
            {% for author in paper.authorIDs %}
            	{{ paper.authorNames[loop.index - 1]}}
            	{% if favoritedAuthors[loop.index - 1] %}
	                <button id="favAuthor{{author}}" style="display: none" onclick="addFavoriteAuthor('{{author}}');">Favorite Author!</button>
	                <button id="defavAuthor{{author}}" onclick="rmFavoriteAuthor('{{author}}');">Unfavorite Author!</button>
	            {% else %}
		            <button id="favAuthor{{author}}" onclick="addFavoriteAuthor('{{author}}');">Favorite Author!</button>
		            <button id="defavAuthor{{author}}" style="display: none" onclick="rmFavoriteAuthor('{{author}}');">Unfavorite Author!</button>
		        {% endif %}
                <br>
            {% endfor %}
            <!-- <canvas id="the-canvas" style="border:1px solid black; width:100; height:100"/> -->
			<object data="/uploads/{{uniqueID}}" type="application/pdf" height="850" width="100%">
				<embed src="/uploads/{{uniqueID}}" type="application/pdf" height="850" width="100%"/>
            </object>
		</div>
	</div>
</div>
<hr class="col-md-12"> <!-- divider line -->
<hr class="col-md-12"> <!-- divider line -->

<script>
function addFavorite() {
	console.log("Adding favorite...");
	$.ajax({
    type : "POST",
    url : "/addFavorite",
    data: {paperID : {{uniqueID}}},
    
    success: function(result) {
        console.log(result);
        document.getElementById("fav").style.display="none";
		document.getElementById("unfav").style.display="inline-block";
    }
});
}

function rmFavorite() {
	console.log("Removing favorite...");
	$.ajax({
    type : "POST",
    url : "/removeFavorite",
    data: {paperID : {{uniqueID}}},
    
    success: function(result) {
        console.log(result);
        document.getElementById("unfav").style.display="none";
		document.getElementById("fav").style.display="inline-block";
    }
});
}

function addFavoriteTag(tagArg) {
	console.log("Adding favorite tag...");
	$.ajax({
    type : "POST",
    url : "/addFavoriteTag",
    data: {tag : tagArg},
    
    success: function(result) {
        console.log(result);
        document.getElementById("favTag".concat(tagArg)).style.display="none";
		document.getElementById("defavTag".concat(tagArg)).style.display="block";
    }
});
}

function rmFavoriteTag(tagArg) {
	console.log("Removing favorite tag...");
	$.ajax({
    type : "POST",
    url : "/removeFavoriteTag",
    data: {tag : tagArg},
    
    success: function(result) {
        console.log(result);
        document.getElementById("defavTag".concat(tagArg)).style.display="none";
		document.getElementById("favTag".concat(tagArg)).style.display="block";
    }
});
}

function addFavoriteAuthor(authorArg) {
	console.log("Adding favorite author...");
	$.ajax({
    type : "POST",
    url : "/addFavoriteAuthor",
    data: {author : authorArg},
    
    success: function(result) {
        console.log(result);
        document.getElementById("favAuthor".concat(authorArg)).style.display="none";
		document.getElementById("defavAuthor".concat(authorArg)).style.display="block";
    }
});
}

function rmFavoriteAuthor(authorArg) {
	console.log("Removing favorite author...");
	$.ajax({
    type : "POST",
    url : "/removeFavoriteAuthor",
    data: {author : authorArg},
    
    success: function(result) {
        console.log(result);
        document.getElementById("defavAuthor".concat(authorArg)).style.display="none";
		document.getElementById("favAuthor".concat(authorArg)).style.display="block";
    }
});
}
</script>

{% endblock %}


